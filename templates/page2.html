<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏≤‡∏¢‡∏∏‡∏ù‡∏ô‡∏ü‡πâ‡∏≤‡∏Ñ‡∏∞‡∏ô‡∏≠‡∏á</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
    body {margin: 0; padding: 0; font-family: "Segoe UI", Tahoma, sans-serif;
          background: linear-gradient(to bottom right, #2a2a2a, #3b3b3b, #ff8c42); color: #fff;}
    .container {display: flex; justify-content: space-between; gap: 20px; padding: 30px; flex-wrap: wrap;}
    .panel {background: rgba(200,200,200,0.1); border-radius: 12px; padding: 20px; flex: 1 1 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5); backdrop-filter: blur(6px);}
    h2 {text-align: center; margin-bottom: 20px; color: #ff9f1c; text-shadow: 1px 1px 5px rgba(0,0,0,0.7);}
    label {display: block; margin-bottom: 6px; font-weight: bold; color: #ffd27f;}
    input {width: 95%; padding: 8px; border: none; border-radius: 6px; margin-bottom: 15px; background: #333; color: #fff;}
    .btn-primary {display: block; width: 100%; padding: 12px; background: linear-gradient(to right, #ff512f, #dd2476);
                  border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;
                  box-shadow: 0 4px 10px rgba(0,0,0,0.5); transition: transform 0.2s, background 0.3s;}
    .btn-primary:hover {transform: scale(1.05); background: linear-gradient(to right, #dd2476, #ff512f);}
    
    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå */
    .results-container {display: flex; flex-direction: column; gap: 25px;}
    .result-today {
        border-radius: 15px; padding: 30px; text-align: center; font-weight: bold; 
        color: black; font-size: 1.6rem;
    }
    .result-future-container {display: flex; justify-content: space-between; gap: 15px;}
    .result-future {
        flex: 1; border-radius: 12px; padding: 20px; text-align: center; font-weight: bold;
        color: black; font-size: 1rem;
    }
    .result-date {font-size: 1.2rem; font-weight: bold; color: black; margin-bottom: 10px;}

    /* ‚úÖ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå */
    .result-today h1 {
        font-size: 3em;
        margin: 0;
        -webkit-text-stroke: 2px #000;   /* ‡∏Ç‡∏≠‡∏ö‡∏î‡∏≥ */
        color: inherit;                  /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô */
    }
    .result-future h2 {
        font-size: 2em;
        margin: 5px 0;
        -webkit-text-stroke: 1.5px #000; /* ‡∏Ç‡∏≠‡∏ö‡∏î‡∏≥ */
        color: inherit;                  /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô */
    }

    .legend {margin-top: 20px;}
    .legend-item {display: flex; align-items: center; margin-bottom: 8px;}
    .color-box {width: 20px; height: 20px; margin-right: 10px; border-radius: 4px; border: 1px solid #000;}
    .green {background: #2ecc71;}
    .yellow {background: #f1c40f;}
    .orange {background: #ff9f1c;}
    .red {background: #e74c3c;}
    small {color: #ddd; font-size: 12px; display:block; margin-top:5px;}
</style>
</head>
<body>
<div class="container">
   <!-- ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ -->
<div class="panel">
    <h2>üìç ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå</h2>

    <h3>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (.csv ‡∏´‡∏£‡∏∑‡∏≠ .xlsx)</h3>
    <p style="font-size:14px; color:#ffd27f; margin-top:-5px;">
        (*‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: ‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 5 ‡∏ß‡∏±‡∏ô)
    </p>
    
    <input type="file" id="fileInput" accept=".csv,.xlsx">
    
    <button type="button" id="predictBtn" class="btn-primary">
        üå©Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå
    </button>

    <small>
        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:  
        - <b>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</b> ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤  
        - <b>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</b> ‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå  
        - <b>‡∏î‡∏±‡∏ä‡∏ô‡∏µ</b> ‡πÄ‡∏ä‡πà‡∏ô Showalter, Lifted, SWEAT ‡∏Ø‡∏•‡∏Ø ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á  
        - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á ‚â• 5 ‡∏ß‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥  
    </small>
</div>

    <!-- ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤ -->
    <div class="panel">
        <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå</h2>
        <div id="results" class="results-container"></div>
        <!-- legend -->
        <div class="legend">
            <h3>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á</h3>
            <div class="legend-item"><div class="color-box green"></div><span>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß = ‡∏ï‡πà‡∏≥ (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)</span></div>
            <div class="legend-item"><div class="color-box yellow"></div><span>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á = ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á)</span></div>
            <div class="legend-item"><div class="color-box orange"></div><span>‡∏™‡πâ‡∏° = ‡∏™‡∏π‡∏á (‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á)</span></div>
            <div class="legend-item"><div class="color-box red"></div><span>‡πÅ‡∏î‡∏á = ‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å (‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)</span></div>
        </div>
    </div>
</div>

<script>
document.getElementById("predictBtn").addEventListener("click", async function() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô"); return; }

  const fd = new FormData(); fd.append("file", file);
  try {
    const res  = await fetch("/predict", { method: "POST", body: fd });
    const data = await res.json();

    if (data.error) {
      document.getElementById("results").innerHTML = `<p style="color:#ff6b6b">${data.error}</p>`;
      return;
    }

    const loc = data.location || {province:"-", district:"-"};
    let html = "";

    // ‚úÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà)
    const today = data.predictions[0];
    html += `
      <div class="result-today" style="background:${today.color}">
        <div class="result-date">${today.date}</div>
        <h1>${today.probability}%</h1>
        <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á: ${today.severity}</p>
        <p>üìç ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${today.district} ‡∏à.${today.province}</p>
      </div>`;

    // ‚úÖ 3 ‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å)
    html += `<div class="result-future-container">`;
    data.predictions.slice(1).forEach(p => {
      html += `
        <div class="result-future" style="background:${p.color}">
          <div class="result-date">${p.date}</div>
          <h2>${p.probability}%</h2>
          <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á: ${p.severity}</p>
          <p>üìç ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${p.district} ‡∏à.${p.province}</p>
        </div>`;
    });
    html += `</div>`;

    document.getElementById("results").innerHTML = html;

  } catch (err) {
    document.getElementById("results").innerHTML = `<p style="color:#ff6b6b">‚ùå ${err}</p>`;
  }
});
</script>
</body>
</html>
